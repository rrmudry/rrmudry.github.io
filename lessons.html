<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Lessons & Archive â€¢ Mr. Mudryâ€™s Physics</title>
  <link rel="icon" type="image/png" href="head.png"/>
  <link rel="apple-touch-icon" href="apple-touch-icon.svg"/>
  <link rel="stylesheet" href="assets/theme.css"/>
  <style>
    .lesson-meta {
      font-family: var(--font-tech);
      font-size: 0.8rem;
      color: var(--accent-neon);
      margin-bottom: 0.5rem;
      display: block;
    }
    .archive-section {
      margin-top: 4rem;
    }
  </style>
</head>
<body>
  <div data-include="header"></div>

<main role="main">
  <section class="hero">
    <div class="container">
      <h1>Classroom Sync</h1>
      <div class="energy-bar" aria-hidden="true"></div>
      <p class="subtitle">Semester 2: Momentum, Thermodynamics, E&M, and Waves. Stay synced with daily updates and archives.</p>
    </div>
  </section>

  <section class="container section" aria-labelledby="today-title">
    <h2 id="today-title">Latest from Class</h2>
    <div id="latest-lesson-container">
      <!-- Dynamically filled -->
    </div>
  </section>

  <section class="container section archive-section" aria-labelledby="archive-title">
    <h2 id="archive-title">Lesson Archive</h2>
    <div class="grid" id="archive-grid">
      <!-- Dynamically filled -->
    </div>
  </section>

  <section class="container section" aria-labelledby="unit-index">
    <h2 id="unit-index">Unit Resources</h2>
    <div class="grid">
      <article class="card">
        <h3>Unit 4 â€¢ Momentum & Impulse</h3>
        <p>Current focus. Collisions, explosions, and impact forces.</p>
        <a class="btn primary" href="unit4-dashboard.html">Explore Unit Dashboard</a>
      </article>
      <article class="card">
        <h3>Unit 5 â€¢ Thermodynamics</h3>
        <p>Heat, temperature, and energy transfer.</p>
        <a class="btn" href="#">Upcoming</a>
      </article>
      <article class="card">
        <h3>Unit 6 â€¢ Electricity & Magnetism</h3>
        <p>Fields, circuits, and electromagnetic waves.</p>
        <a class="btn" href="#">Upcoming</a>
      </article>
      <article class="card">
        <h3>Unit 7 â€¢ Waves & Sound</h3>
        <p>Vibrations, wave properties, and optics.</p>
        <a class="btn" href="#">Upcoming</a>
      </article>
      <article class="card">
        <h3>Archive â€¢ Physics Foundations</h3>
        <p>Units 1-3: Kinematics, Dynamics, and Energy.</p>
        <a class="btn" href="unit1.html">Semester 1 Materials</a>
      </article>
    </div>
  </section>
</main>

  <div data-include="footer"></div>
  <script>
    function renderLessons() {
      const latestContainer = document.getElementById('latest-lesson-container');
      const archiveGrid = document.getElementById('archive-grid');
      
      if (!latestContainer || !archiveGrid) return;
      if (typeof lessonsData === 'undefined' || !lessonsData.length) {
          latestContainer.innerHTML = '<p>No lessons posted yet for Semester 2.</p>';
          archiveGrid.innerHTML = '<p>The archive will appear once lessons are added.</p>';
          return;
      }

      // Sort with local date awareness
      const now = new Date();
      const y = now.getFullYear();
      const m = String(now.getMonth() + 1).padStart(2, '0');
      const d = String(now.getDate()).padStart(2, '0');
      const todayStr = `${y}-${m}-${d}`;
      
      const sortedLessons = [...lessonsData].sort((a, b) => new Date(b.date) - new Date(a.date));
      const latest = sortedLessons.find(l => l.date <= todayStr);
      
      // 1. Render Latest Lesson
      if (latest) {
        latestContainer.innerHTML = `
          <article class="card highlight animate-in fade-in duration-500" style="max-width: 800px;">
            <span class="lesson-meta">Day ${latest.day} â€¢ Unit ${latest.unit} â€¢ ${latest.date}</span>
            <h3>${latest.title}</h3>
            <p>${latest.summary}</p>
            <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
              <p><strong>In-Class Activities:</strong><br>${latest.details}</p>
              <div style="display: flex; gap: 0.75rem; margin-top: 1rem; flex-wrap: wrap;">
                ${latest.pdfLink ? `<a href="${latest.pdfLink}" class="btn primary" target="_blank">ðŸ“„ View Worksheet</a>` : ''}
                <a class="btn" href="unit${latest.unit}-dashboard.html">Unit ${latest.unit} Dashboard</a>
                <a class="btn" href="index.html">Back to Home</a>
              </div>
            </div>
          </article>
        `;
      }

      // 2. Render Archive (grouped or filtered)
      archiveGrid.innerHTML = '';
      const archiveLessons = sortedLessons.filter(l => l !== latest && l.date <= todayStr);
      
      if (archiveLessons.length === 0) {
        archiveGrid.innerHTML = '<p style="grid-column: 1/-1; opacity: 0.5;">Older lessons will be listed here.</p>';
      } else {
        archiveLessons.forEach(lesson => {
          const card = document.createElement('article');
          card.className = 'card animate-in slide-in-from-bottom-4 duration-300';
          card.innerHTML = `
            <span class="lesson-meta">Unit ${lesson.unit} â€¢ Day ${lesson.day} â€¢ ${lesson.date}</span>
            <h3>${lesson.title}</h3>
            <p>${lesson.summary}</p>
            <div style="margin-top: auto; display: flex; gap: 0.5rem; flex-wrap: wrap; padding-top: 1rem;">
              <a class="btn" href="unit${lesson.unit}-dashboard.html">Dashboard</a>
              ${lesson.pdfLink ? `<a class="btn secondary" href="${lesson.pdfLink}" target="_blank">ðŸ“„ PDF</a>` : ''}
            </div>
          `;
          archiveGrid.appendChild(card);
        });
      }
    }

    // Load with cache-buster
    const lessonScript = document.createElement('script');
    lessonScript.src = 'assets/lessons-data.js?v=' + Date.now();
    lessonScript.onload = () => {
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        renderLessons();
      }
    };
    document.head.appendChild(lessonScript);

    document.addEventListener('DOMContentLoaded', () => {
      renderLessons();
    });
  </script>
  <script src="assets/partials.js"></script>
</body>
</html>
