<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%3E%3Cpath%20d='M5%2022h14M6%2018h12M6%2014h12M6%2010h12M8.5%202h7l-1%208h-5l-1-8Z'/%3E%3C/svg%3E" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Density Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel Standalone for in-browser JSX/TSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="stylesheet" href="/index.css">
</head>
  <body class="bg-slate-100">
    <div id="root"></div>
    <script type="text/babel">
      // From constants.ts
      const SCIENCE_OBJECTS = [
        { id: 1, name: '8-Ball', mass: 170, volume: 100, icon: 'ðŸŽ±' }, // Density: 1.7 g/mL (Phenolic Resin)
        { id: 2, name: 'Gem Stone', mass: 105.3, volume: 30, icon: 'ðŸ’Ž' }, // Density: 3.51 g/mL (Diamond)
        { id: 3, name: '1st Place Medal', mass: 386, volume: 20, icon: 'ðŸ¥‡' }, // Density: 19.3 g/mL (Gold)
        { id: 4, name: 'Chess Pawn', mass: 13.5, volume: 15, icon: 'â™Ÿï¸' }, // Density: 0.9 g/mL (Plastic)
        { id: 5, name: 'Gear', mass: 314, volume: 40, icon: 'âš™ï¸' }, // Density: 7.85 g/mL (Steel)
        { id: 6, name: 'Phone Receiver', mass: 165, volume: 150, icon: 'ðŸ“ž' }, // Density: 1.1 g/mL (Bakelite)
        { id: 7, name: 'Vase', mass: 300, volume: 120, icon: 'ðŸº' }, // Density: 2.5 g/mL (Ceramic)
        { id: 8, name: 'Mini-Moai', mass: 756, volume: 270, icon: 'ðŸ—¿' }, // Density: 2.8 g/mL (Basalt)
        { id: 9, name: 'Camera', mass: 500, volume: 350, icon: 'ðŸ“·' }, // Density: 1.43 g/mL (Mixed materials)
        { id: 10, name: 'Lightbulb', mass: 30, volume: 180, icon: 'ðŸ’¡' }, // Density: 0.17 g/mL (Mostly air)
        { id: 11, name: 'Crown', mass: 2932.5, volume: 345, icon: 'ðŸ‘‘' }, // Density: 8.5 g/mL (Brass)
      ];
      const INITIAL_WATER_VOLUME = 500;
      const MAX_BEAKER_VOLUME = 1000;
      const MATERIALS_DENSITY = [
        { material: 'Bakelite', density: '1.10' },       // Phone Receiver
        { material: 'Basalt', density: '2.80' },         // Mini-Moai
        { material: 'Ceramic', density: '2.50' },        // Vase
        { material: 'Diamond', density: '3.51' },        // Gem Stone
        { material: 'Phenolic Resin', density: '1.70' }, // 8-Ball
        { material: 'Plastic', density: '0.90' },        // Chess Pawn
        { material: 'Steel', density: '7.85' },          // Gear
      ].sort((a, b) => a.material.localeCompare(b.material));

      // From App.tsx
      const { useState, useCallback, useMemo, useEffect } = React;

      const ObjectLibrary = ({ onDragStart }) => (
        <aside className="w-1/4 min-w-[200px] bg-white p-2 rounded-lg shadow-md">
          <h2 className="text-md font-bold text-slate-700 border-b pb-1 mb-1.5">Object Library</h2>
          <div className="grid grid-cols-2 gap-1">
            {SCIENCE_OBJECTS.map((object) => (
              <div
                key={object.id}
                draggable
                onDragStart={(e) => onDragStart(e, object)}
                className="flex flex-col items-center justify-center py-2 bg-slate-100 rounded-md cursor-grab active:cursor-grabbing transition-all hover:bg-sky-100 hover:shadow-sm"
              >
                <span className="text-lg leading-none">{object.icon}</span>
                <span className="text-[10px] font-medium text-slate-600 text-center mt-1">{object.name}</span>
              </div>
            ))}
          </div>
        </aside>
      );

      const InteractiveWorkspace = ({
        objectOnScale, objectInBeaker, isDraggingOverScale, isDraggingOverBeaker,
        onDropOnScale, onDropInBeaker, onDragOver,
        onDragEnterScale, onDragLeaveScale, onDragEnterBeaker, onDragLeaveBeaker,
        displacedVolume, isManuallySubmerged, setIsManuallySubmerged
      }) => {
        const waterVolume = displacedVolume !== null ? INITIAL_WATER_VOLUME + displacedVolume : INITIAL_WATER_VOLUME;
        const waterHeightPercentage = (waterVolume / MAX_BEAKER_VOLUME) * 100;
        const objectDensity = objectInBeaker ? objectInBeaker.mass / objectInBeaker.volume : 0;
        const isFloating = objectDensity < 1 && !isManuallySubmerged;
        
        return (
          <main className="w-full flex items-center justify-center gap-6 p-2">
            {/* Digital Balance */}
            <div
              onDrop={onDropOnScale}
              onDragOver={onDragOver}
              onDragEnter={onDragEnterScale}
              onDragLeave={onDragLeaveScale}
              className={`w-[280px] h-[300px] flex flex-col items-center justify-center p-4 border-2 border-dashed rounded-lg transition-all ${isDraggingOverScale ? 'border-sky-500 bg-sky-50' : 'border-slate-300'}`}
            >
              <div className="relative w-[280px] h-[120px]">
                {objectOnScale && (
                  <div 
                    className={`absolute bottom-[90px] left-1/2 -translate-x-1/2 animate-fade-in ${(objectOnScale.id === 4 || objectOnScale.id === 2) ? 'text-4xl' : 'text-8xl'}`} 
                    style={{ textShadow: '0 2px 4px rgba(0,0,0,0.2)' }}
                  >
                    {objectOnScale.icon}
                  </div>
                )}
                <div className="absolute bottom-0 left-0 w-full h-[80px] bg-gradient-to-b from-slate-200 to-slate-300 rounded-lg shadow-md border border-slate-400 flex items-center justify-center">
                  <div
                    className="w-[120px] h-[35px] bg-slate-800 rounded flex items-center justify-between px-3 border-2 border-black/50 shadow-inner"
                    style={{boxShadow: 'inset 0 1px 4px rgba(0,0,0,0.7), 0 0 15px 2px rgba(56, 189, 248, 0.3)'}}
                    role="status"
                    aria-live="polite"
                    aria-atomic="true"
                  >
                    <p className="text-2xl font-mono text-sky-300" style={{ textShadow: '0 0 5px #38bdf8, 0 0 10px #38bdf8' }}>
                      {objectOnScale ? objectOnScale.mass.toFixed(1) : '0.0'}
                    </p>
                    <p className="text-lg font-mono text-sky-300/70" style={{ textShadow: '0 0 5px #38bdf8' }}>
                      g
                    </p>
                  </div>
                </div>
                <div className="absolute top-[20px] left-1/2 -translate-x-1/2 w-[220px] h-[20px] bg-gradient-to-b from-slate-400 to-slate-500 rounded-md shadow-sm border-b-2 border-slate-600"></div>
              </div>
              <p className="mt-2 text-xs font-semibold text-slate-500 uppercase tracking-wider">Digital Balance</p>
            </div>

            {/* Beaker */}
            <div
              onDrop={onDropInBeaker}
              onDragOver={onDragOver}
              onDragEnter={onDragEnterBeaker}
              onDragLeave={onDragLeaveBeaker}
              className={`w-[280px] h-[300px] flex justify-center items-end p-2 border-2 border-dashed rounded-lg transition-all ${isDraggingOverBeaker ? 'border-sky-500 bg-sky-50' : 'border-slate-300'}`}
            >
              <div className="relative w-56 h-full bg-slate-200 border-x-4 border-b-4 border-slate-400 rounded-b-xl overflow-hidden">
                  <div
                      className="absolute bottom-0 left-0 w-full bg-blue-300/70 transition-all duration-700 ease-in-out"
                      style={{ height: `${waterHeightPercentage}%` }}
                  >
                    {objectInBeaker && (
                        isFloating ? (
                            <div
                                onMouseDown={(e) => { e.stopPropagation(); setIsManuallySubmerged(true); }}
                                title="Click and hold to submerge"
                                className={`absolute top-0 left-1/2 animate-fade-in cursor-pointer ${(objectInBeaker.id === 4 || objectInBeaker.id === 2) ? 'text-5xl' : 'text-9xl'}`}
                                style={{
                                    transform: `translateX(-50%) translateY(-${(1 - objectDensity) * 40 + 10}%)`,
                                    textShadow: '0 2px 4px rgba(0,0,0,0.2)',
                                    transition: 'transform 0.7s ease-in-out'
                                }}
                            >
                                {objectInBeaker.icon}
                            </div>
                        ) : (
                            <div className={`absolute w-full h-full flex justify-center items-end pb-2 animate-fade-in ${(objectInBeaker.id === 4 || objectInBeaker.id === 2) ? 'text-5xl' : 'text-9xl'}`}>
                                {objectInBeaker.icon}
                            </div>
                        )
                    )}
                  </div>
                   <div className="absolute bottom-0 left-0 w-full transition-all duration-700 ease-in-out" style={{ height: `${(INITIAL_WATER_VOLUME / MAX_BEAKER_VOLUME) * 100}%` }}>
                      <div className="absolute top-0 w-full border-t border-dashed border-blue-800/50"></div>
                      <span className="absolute -right-1 top-0 -translate-y-1/2 text-xs text-blue-800/80 bg-slate-100 px-1 rounded">{INITIAL_WATER_VOLUME}ml</span>
                   </div>

                  {[...Array(5)].map((_, i) => {
                    const volume = (i + 1) * 200;
                    return (
                       <div key={volume} className="absolute w-full" style={{bottom: `${(volume / MAX_BEAKER_VOLUME)*100}%`}}>
                          <div className="absolute left-0 w-4 border-t border-slate-500"></div>
                          <span className="absolute -left-1 -translate-x-full -translate-y-1/2 text-xs text-slate-500">{volume}</span>
                       </div>
                    )
                  })}
              </div>
            </div>
          </main>
        );
      };

      const DataPanel = ({ mass, volume, density, mismatchError, isGlitched }) => {
        const densityValue = parseFloat(density);
        const showDensityResult = density !== null && !isGlitched;
        const floats = showDensityResult && densityValue < 1;
        const sinks = showDensityResult && densityValue >= 1;

        const densityBoxClasses = `p-3 rounded-md border transition-colors ${
          floats ? 'bg-green-100 border-green-300' : 
          sinks ? 'bg-red-100 border-red-300' : 
          'bg-sky-100 border-sky-300'
        }`;

        const densityLabelClasses = `text-sm font-semibold ${
          floats ? 'text-green-800' : 
          sinks ? 'text-red-800' : 
          'text-sky-800'
        }`;
        
        const densityValueClasses = `text-2xl font-mono ${
          floats ? 'text-green-900' :
          sinks ? 'text-red-900' :
          'text-sky-900'
        }`;

        return (
          <aside className="w-1/4 min-w-[200px] bg-white p-4 rounded-lg shadow-md flex flex-col">
            <h2 className="text-xl font-bold text-slate-700 border-b pb-2 mb-4">Data & Results</h2>
            <div className="space-y-4 flex-grow">
              <div className="bg-slate-100 p-3 rounded-md">
                <label className="text-sm font-semibold text-slate-500">Mass</label>
                <p className="text-2xl font-mono text-slate-800">{mass !== null ? `${mass.toFixed(1)} g` : '--- g'}</p>
              </div>
              <div className="bg-slate-100 p-3 rounded-md">
                <label className="text-sm font-semibold text-slate-500">Volume (Displaced)</label>
                <p className="text-2xl font-mono text-slate-800">{volume !== null ? `${volume.toFixed(1)} mL` : '--- mL'}</p>
              </div>

              {mismatchError && (
                <div className="bg-yellow-100 text-yellow-800 p-3 rounded-md border border-yellow-300 text-sm font-medium">
                  <p>Object Mismatch! Please measure the mass and volume of the <span className="font-bold">same object</span> to calculate density.</p>
                </div>
              )}

              <div className={densityBoxClasses}>
                <label className={densityLabelClasses}>Density (Mass / Volume)</label>
                {isGlitched ? (
                  <div 
                      className="bg-slate-800 p-2 mt-1 rounded border-2 border-red-500/50 shadow-inner"
                      style={{boxShadow: 'inset 0 1px 4px rgba(0,0,0,0.7), 0 0 15px 2px rgba(239, 68, 68, 0.3)'}}
                      role="alert"
                  >
                      <p 
                          className="text-3xl font-mono text-red-400 text-center animate-pulse"
                          style={{ textShadow: '0 0 5px #ef4444, 0 0 10px #ef4444' }}
                      >
                          #ERR!
                      </p>
                      <p className="text-xs text-yellow-400 text-center font-mono mt-1">Manual Calculation Required</p>
                  </div>
                ) : (
                  <div>
                    <p className={densityValueClasses}>{density !== null ? `${density} g/mL` : '--- g/mL'}</p>
                    {floats && <p className="text-sm font-medium text-green-800 mt-1">This object floats in water!</p>}
                    {sinks && <p className="text-sm font-medium text-red-800 mt-1">This object sinks in water!</p>}
                  </div>
                )}
              </div>
              
              <div>
                <h3 className="text-md font-bold text-slate-700 mb-2">Reference Densities</h3>
                <div className="rounded-md border border-slate-200 overflow-hidden">
                  <table className="w-full text-sm text-left text-slate-600">
                    <thead className="text-xs text-slate-700 uppercase bg-slate-100">
                      <tr>
                        <th scope="col" className="px-4 py-2 font-semibold">Material</th>
                        <th scope="col" className="px-4 py-2 font-semibold text-right">Density (g/mL)</th>
                      </tr>
                    </thead>
                    <tbody>
                      {MATERIALS_DENSITY.map(item => (
                        <tr key={item.material} className="bg-white border-b last:border-b-0 border-slate-200">
                          <td className="px-4 py-1.5 font-medium text-slate-900">{item.material}</td>
                          <td className="px-4 py-1.5 text-right font-mono">{item.density}</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>

            </div>
          </aside>
        );
      };

      function App() {
        const [objectOnScale, setObjectOnScale] = useState(null);
        const [objectInBeaker, setObjectInBeaker] = useState(null);
        const [isDraggingOverScale, setIsDraggingOverScale] = useState(false);
        const [isDraggingOverBeaker, setIsDraggingOverBeaker] = useState(false);
        const [isManuallySubmerged, setIsManuallySubmerged] = useState(false);
        
        useEffect(() => {
          setIsManuallySubmerged(false);
        }, [objectInBeaker]);

        const displacedVolume = useMemo(() => {
            if (!objectInBeaker) return null;
            
            const objectDensity = objectInBeaker.mass / objectInBeaker.volume;
            
            if (objectDensity < 1 && !isManuallySubmerged) {
              return objectInBeaker.mass;
            }
            
            return objectInBeaker.volume;
        }, [objectInBeaker, isManuallySubmerged]);

        const mass = objectOnScale?.mass || null;
        const objectVolume = objectInBeaker?.volume || null;
        
        const isSameObject = objectOnScale && objectInBeaker && objectOnScale.id === objectInBeaker.id;
        const hasMismatchedObjects = objectOnScale && objectInBeaker && objectOnScale.id !== objectInBeaker.id;
        
        const density = isSameObject ? (mass / objectVolume).toFixed(2) : null;
        const isGlitchedObject = isSameObject && (objectOnScale.id === 3 || objectOnScale.id === 11);
        
        const handleDragStart = useCallback((e, object) => {
          e.dataTransfer.setData('application/json', JSON.stringify(object));
          e.dataTransfer.effectAllowed = 'copy';
        }, []);
        
        const handleDragOver = useCallback((e) => {
          e.preventDefault();
          e.dataTransfer.dropEffect = 'copy';
        }, []);

        const handleDropOnScale = useCallback((e) => {
          e.preventDefault();
          try {
            const objectData = JSON.parse(e.dataTransfer.getData('application/json'));
            setObjectOnScale(objectData);
          } catch (error) {
            console.error("Failed to parse dropped data:", error);
          }
          setIsDraggingOverScale(false);
        }, []);

        const handleDropInBeaker = useCallback((e) => {
          e.preventDefault();
          try {
            const objectData = JSON.parse(e.dataTransfer.getData('application/json'));
            setObjectInBeaker(objectData);
          } catch (error) {
            console.error("Failed to parse dropped data:", error);
          }
          setIsDraggingOverBeaker(false);
        }, []);
        
        const handleReset = useCallback(() => {
          setObjectOnScale(null);
          setObjectInBeaker(null);
        }, []);

        return (
          <div
            className="h-screen flex flex-col p-4 font-sans bg-slate-50"
            onMouseUp={() => setIsManuallySubmerged(false)}
          >
            <header className="text-center mb-4">
              <h1 className="text-3xl font-extrabold text-slate-800">Interactive Density Lab</h1>
              <p className="text-slate-500 mt-1">Drag objects to measure their mass and volume to discover their density!</p>
            </header>
            <div className="flex flex-grow gap-6">
              <ObjectLibrary onDragStart={handleDragStart} />
              <div className="w-1/2 flex flex-col items-center">
                 <InteractiveWorkspace
                    objectOnScale={objectOnScale}
                    objectInBeaker={objectInBeaker}
                    isDraggingOverScale={isDraggingOverScale}
                    isDraggingOverBeaker={isDraggingOverBeaker}
                    onDropOnScale={handleDropOnScale}
                    onDropInBeaker={handleDropInBeaker}
                    onDragOver={handleDragOver}
                    onDragEnterScale={() => setIsDraggingOverScale(true)}
                    onDragLeaveScale={() => setIsDraggingOverScale(false)}
                    onDragEnterBeaker={() => setIsDraggingOverBeaker(true)}
                    onDragLeaveBeaker={() => setIsDraggingOverBeaker(false)}
                    displacedVolume={displacedVolume}
                    isManuallySubmerged={isManuallySubmerged}
                    setIsManuallySubmerged={setIsManuallySubmerged}
                  />
                  <button
                    onClick={handleReset}
                    className="mt-4 bg-slate-600 text-white font-bold py-2 px-4 rounded-md hover:bg-slate-700 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-500"
                  >
                    Reset Simulation
                  </button>
              </div>
              <DataPanel
                mass={mass}
                volume={displacedVolume}
                density={density}
                mismatchError={hasMismatchedObjects}
                isGlitched={isGlitchedObject}
              />
            </div>
          </div>
        );
      }

      // From index.tsx
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }
      const root = ReactDOM.createRoot(rootElement);
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>