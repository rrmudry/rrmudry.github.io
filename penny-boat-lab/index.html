<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Penny Boat Physics Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
            overflow: hidden;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #38bdf8;
            cursor: pointer;
            margin-top: -6px;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #334155;
            border-radius: 2px;
        }

        #sim-container {
            cursor: grab;
        }

        #sim-container:active {
            cursor: grabbing;
        }
    </style>
</head>

<body class="h-screen w-screen flex flex-col md:flex-row">

    <!-- Control Panel -->
    <div
        class="w-full md:w-80 bg-slate-800 border-b md:border-b-0 md:border-r border-slate-700 p-6 flex flex-col gap-6 z-10 overflow-y-auto shadow-xl">
        <div>
            <h1 class="text-2xl font-bold text-sky-400 mb-1">Archimedes 3D Lab</h1>
            <p class="text-xs text-slate-400">Penny Boat Buoyancy Simulator</p>
        </div>

        <!-- Boat Dimensions -->
        <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-700/50">
            <h2 class="text-sm font-semibold text-slate-300 mb-4 uppercase tracking-wider">Design Boat</h2>
            <div class="mb-4">
                <div class="flex justify-between text-sm mb-1"><label class="text-slate-400">Length (cm)</label><span
                        id="v-len" class="font-mono text-sky-300">15 cm</span></div>
                <input type="range" id="b-len" min="2" max="23" value="15" step="1">
            </div>
            <div class="mb-4">
                <div class="flex justify-between text-sm mb-1"><label class="text-slate-400">Width (cm)</label><span
                        id="v-wid" class="font-mono text-sky-300">7 cm</span></div>
                <input type="range" id="b-wid" min="2" max="13" value="7" step="1">
            </div>
            <div>
                <div class="flex justify-between text-sm mb-1"><label class="text-slate-400">Height (cm)</label><span
                        id="v-hgt" class="font-mono text-sky-300">4 cm</span></div>
                <input type="range" id="b-hgt" min="1" max="6" value="4" step="1">
            </div>

            <div class="mt-4 bg-slate-800 p-3 rounded-lg border border-slate-700">
                <div class="flex justify-between items-end mb-1">
                    <p class="text-[11px] text-slate-400 font-semibold uppercase">Foil Sheet</p>
                    <p id="f-txt" class="text-xs font-mono text-sky-300">0 x 0 cm</p>
                </div>
                <div class="space-y-1.5 mt-2">
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] text-slate-500 w-10">Width</span>
                        <div class="flex-1 bg-slate-900 rounded-full h-1.5">
                            <div id="f-bw" class="bg-sky-400 h-1.5 rounded-full transition-all" style="width: 0%"></div>
                        </div>
                        <span class="text-[10px] text-slate-500 w-6 text-right">15</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] text-slate-500 w-10">Length</span>
                        <div class="flex-1 bg-slate-900 rounded-full h-1.5">
                            <div id="f-bl" class="bg-indigo-400 h-1.5 rounded-full transition-all" style="width: 0%">
                            </div>
                        </div>
                        <span class="text-[10px] text-slate-500 w-6 text-right">25</span>
                    </div>
                </div>
                <p id="f-wrn" class="text-[10px] text-amber-500 mt-2 hidden leading-tight">Max foil size reached!</p>
            </div>
        </div>

        <!-- Actions -->
        <div class="bg-slate-900/50 p-4 rounded-xl border border-slate-700/50">
            <h2 class="text-sm font-semibold text-slate-300 mb-4 uppercase tracking-wider">Add Mass</h2>
            <div class="grid grid-cols-2 gap-2 mb-3">
                <button id="b-add1"
                    class="bg-amber-600 hover:bg-amber-500 text-white py-2 rounded-lg font-medium transition-colors shadow-lg active:scale-95">+1
                    Random</button>
                <button id="b-add10"
                    class="bg-amber-700 hover:bg-amber-600 text-white py-2 rounded-lg font-medium transition-colors shadow-lg active:scale-95">+10
                    Random</button>
            </div>
            <p class="text-[11px] text-sky-400 mb-3 text-center bg-sky-900/30 py-2 rounded border border-sky-800/50">ðŸ’¡
                Click inside boat to place pennies!</p>
            <button id="b-rst"
                class="w-full bg-slate-700 hover:bg-slate-600 text-white py-2 rounded-lg font-medium transition-colors active:scale-95">Reset
                Lab</button>
        </div>

        <!-- Telemetry -->
        <div class="flex-1 bg-slate-900/50 p-4 rounded-xl border border-slate-700/50 flex flex-col">
            <h2 class="text-sm font-semibold text-slate-300 mb-3 uppercase tracking-wider">Telemetry</h2>
            <div class="space-y-2 text-sm">
                <div class="flex justify-between items-center border-b border-slate-700/50 pb-1"><span
                        class="text-slate-400">Total Mass:</span><span id="s-mass" class="font-mono text-white">0
                        g</span></div>
                <div class="flex justify-between items-center border-b border-slate-700/50 pb-1"><span
                        class="text-slate-400">Draft (Depth):</span><span id="s-drft" class="font-mono text-white">0.0
                        cm</span></div>
                <div class="flex justify-between items-center border-b border-slate-700/50 pb-1"><span
                        class="text-slate-400">Displaced Vol:</span><span id="s-vol" class="font-mono text-white">0.0
                        cmÂ³</span></div>
                <div class="flex justify-between items-center"><span class="text-slate-400">Pennies:</span><span
                        id="s-cnt" class="font-mono text-amber-400 font-bold">0</span></div>
            </div>
        </div>
    </div>

    <!-- Simulation -->
    <div class="flex-1 relative" id="sim-container">
        <!-- Sunk Modal -->
        <div id="s-ovr"
            class="absolute inset-0 bg-red-900/20 backdrop-blur-[2px] flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-500 z-20">
            <div class="bg-slate-900 p-8 rounded-2xl border border-red-500/50 text-center shadow-2xl transform scale-95 transition-transform duration-500"
                id="s-mod">
                <h2 class="text-4xl font-black text-red-500 mb-2 uppercase tracking-widest">Sunk!</h2>
                <p id="s-rsn" class="text-slate-300 mb-6">Mass exceeded displacement limits.</p>
                <div class="flex justify-center gap-4 text-left">
                    <div class="bg-slate-800 p-3 rounded-lg border border-slate-700">
                        <p class="text-xs text-slate-400">Pennies Hold</p>
                        <p id="f-cnt" class="text-2xl font-mono text-amber-400">0</p>
                    </div>
                </div>
                <button onclick="window.lab.reset()"
                    class="mt-6 bg-red-600 hover:bg-red-500 text-white px-8 py-3 rounded-lg font-bold transition-colors">Try
                    Again</button>
            </div>
        </div>
    </div>

    <!-- Module Script ensuring no 'Unexpected end of input' via robust ESM setup -->
    <script type="module">
        import * as THREE from 'https://esm.sh/three@0.128.0';
        import { OrbitControls } from 'https://esm.sh/three@0.128.0/examples/jsm/controls/OrbitControls.js';
        import * as CANNON from 'https://esm.sh/cannon-es@0.20.0';

        class PennyBoatLab3D {
            constructor() {
                // Physics constants
                this.WATER_DENSITY = 1.0;
                this.PENNY_MASS = 2.5;
                this.FOIL_AREA_DENSITY = 0.05;

                // Lab State
                this.len = 15; this.wid = 7; this.hgt = 4;
                this.pennies = 0; this.floatingPennies = 0;
                this.isSunk = false;
                this.targetPitch = 0; this.targetRoll = 0;
                this.massBoat = 0; this.massTotal = 0; this.draft = 0;

                this.pennyMeshes = []; this.pennyBodies = [];
                this.container = document.getElementById('sim-container');

                this.initPhys();
                this.init3D();
                this.bindEvts();
                this.updateFoilUI();

                window.addEventListener('resize', () => this.resize());
                this.updatePhys();
                this.anim();
            }

            initPhys() {
                this.world = new CANNON.World({ gravity: new CANNON.Vec3(0, -40, 0) });
                this.world.broadphase = new CANNON.SAPBroadphase(this.world);
                this.world.solver.iterations = 20; // Increase solver iterations for stability
                this.mat = new CANNON.Material();
                this.world.addContactMaterial(new CANNON.ContactMaterial(this.mat, this.mat, { friction: 0.5, restitution: 0.0 })); // Less bounce

                const floor = new CANNON.Body({ type: CANNON.Body.STATIC, shape: new CANNON.Plane(), material: this.mat });
                floor.quaternion.setFromEuler(-Math.PI / 2, 0, 0);
                floor.position.y = -10;
                this.world.addBody(floor);
            }

            init3D() {
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color('#0f172a');

                this.camera = new THREE.PerspectiveCamera(45, this.container.clientWidth / this.container.clientHeight, 0.1, 1000);
                this.camera.position.set(20, 15, 20);

                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
                this.renderer.shadowMap.enabled = true;
                this.container.appendChild(this.renderer.domElement);

                this.controls = new OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.maxPolarAngle = Math.PI / 2 - 0.05;

                this.scene.add(new THREE.AmbientLight(0xffffff, 0.4));
                this.scene.add(new THREE.HemisphereLight(0xffffff, 0x444444, 0.6));
                const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
                dirLight.position.set(20, 40, 20);
                dirLight.castShadow = true;
                this.scene.add(dirLight);

                const waterMat = new THREE.MeshPhysicalMaterial({ color: 0x0284c7, transparent: true, opacity: 0.6, depthWrite: false, side: THREE.DoubleSide });

                this.waterGroup = new THREE.Group();
                ['N', 'S', 'W', 'E'].forEach(d => {
                    let m = new THREE.Mesh(new THREE.PlaneGeometry(1, 1), waterMat);
                    m.rotation.x = -Math.PI / 2;
                    this.waterGroup.add(m);
                    this['w' + d] = m;
                });
                this.scene.add(this.waterGroup);

                this.waterSolid = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), waterMat);
                this.waterSolid.rotation.x = -Math.PI / 2;
                this.waterSolid.visible = false;
                this.scene.add(this.waterSolid);

                const grid = new THREE.GridHelper(200, 40, 0x334155, 0x1e293b);
                grid.position.y = -10;
                this.scene.add(grid);

                this.boatGroup = new THREE.Group();
                this.scene.add(this.boatGroup);

                this.foilMat = new THREE.MeshStandardMaterial({ color: 0xcccccc, metalness: 0.6, roughness: 0.5, side: THREE.DoubleSide });
                this.pennyMat = new THREE.MeshStandardMaterial({ color: 0xb45309, metalness: 0.6, roughness: 0.4 });

                this.aBuoy = new THREE.ArrowHelper(new THREE.Vector3(0, 1, 0), new THREE.Vector3(0, 0, 0), 5, 0x4ade80);
                this.aGrav = new THREE.ArrowHelper(new THREE.Vector3(0, -1, 0), new THREE.Vector3(0, 0, 0), 5, 0xf87171);
                this.boatGroup.add(this.aBuoy, this.aGrav);

                this.buildBoat();
            }

            buildBoat() {
                // Clear old visual walls
                const toRem = this.boatGroup.children.filter(c => c.isMesh);
                toRem.forEach(c => { this.boatGroup.remove(c); c.geometry.dispose(); });

                const t = 0.2, w = this.wid, l = this.len, h = this.hgt;

                const addWall = (geo, x, y, z) => {
                    let m = new THREE.Mesh(geo, this.foilMat);
                    m.position.set(x, y, z);
                    m.castShadow = true;
                    this.boatGroup.add(m);
                };

                addWall(new THREE.BoxGeometry(w, t, l), 0, t / 2, 0); // Bottom
                const fb = new THREE.BoxGeometry(w, h, t);
                addWall(fb, 0, h / 2, l / 2 - t / 2); // Front
                addWall(fb, 0, h / 2, -l / 2 + t / 2); // Back
                const lr = new THREE.BoxGeometry(t, h, l - t * 2);
                addWall(lr, -w / 2 + t / 2, h / 2, 0); // Left
                addWall(lr, w / 2 - t / 2, h / 2, 0); // Right

                // Refresh Physics body
                if (this.boatPhys) this.world.removeBody(this.boatPhys);
                this.boatPhys = new CANNON.Body({ type: CANNON.Body.KINEMATIC, position: new CANNON.Vec3().copy(this.boatGroup.position) });

                // Anti-tunneling: Give the bottom physical shape extra thickness downwards
                const physT = 2.0;
                this.boatPhys.addShape(new CANNON.Box(new CANNON.Vec3(w / 2, physT / 2, l / 2)), new CANNON.Vec3(0, t - physT / 2, 0));

                let fbs = new CANNON.Box(new CANNON.Vec3(w / 2, h / 2, t / 2));
                this.boatPhys.addShape(fbs, new CANNON.Vec3(0, h / 2, l / 2 - t / 2));
                this.boatPhys.addShape(fbs, new CANNON.Vec3(0, h / 2, -l / 2 + t / 2));
                let lrs = new CANNON.Box(new CANNON.Vec3(t / 2, h / 2, l / 2 - t));
                this.boatPhys.addShape(lrs, new CANNON.Vec3(-w / 2 + t / 2, h / 2, 0));
                this.boatPhys.addShape(lrs, new CANNON.Vec3(w / 2 - t / 2, h / 2, 0));

                this.world.addBody(this.boatPhys);
                this.aBuoy.position.set(0, h / 2, 0);
                this.aGrav.position.set(0, h / 2, 0);

                this.updateHole();
            }

            updateHole() {
                const p = 200, hw = this.wid - 0.1, hl = this.len - 0.1;
                const setP = (m, pw, ph, px, pz) => {
                    m.geometry.dispose();
                    m.geometry = new THREE.PlaneGeometry(pw, ph);
                    m.position.set(px, 0, pz);
                };
                setP(this.wN, p, (p - hl) / 2, 0, -hl / 2 - (p - hl) / 4);
                setP(this.wS, p, (p - hl) / 2, 0, hl / 2 + (p - hl) / 4);
                setP(this.wW, (p - hw) / 2, hl, -hw / 2 - (p - hw) / 4, 0);
                setP(this.wE, (p - hw) / 2, hl, hw / 2 + (p - hw) / 4, 0);
            }

            bindEvts() {
                const enforce = (prop) => {
                    let L = +document.getElementById('b-len').value, W = +document.getElementById('b-wid').value, H = +document.getElementById('b-hgt').value;
                    let warn = false;

                    if (prop === 'l' && L + 2 * H > 25) { L = 25 - 2 * H; warn = true; }
                    else if (prop === 'w' && W + 2 * H > 15) { W = 15 - 2 * H; warn = true; }
                    else if (prop === 'h') {
                        if (L + 2 * H > 25) { L = 25 - 2 * H; warn = true; }
                        if (W + 2 * H > 15) { W = 15 - 2 * H; warn = true; }
                    }

                    this.len = L; this.wid = W; this.hgt = H;
                    document.getElementById('b-len').value = L; document.getElementById('b-wid').value = W; document.getElementById('b-hgt').value = H;
                    document.getElementById('v-len').innerText = `${L} cm`; document.getElementById('v-wid').innerText = `${W} cm`; document.getElementById('v-hgt').innerText = `${H} cm`;
                    this.updateFoilUI(warn);
                    this.reset();
                };

                ['len', 'wid', 'hgt'].forEach(p => document.getElementById(`b-${p}`).addEventListener('input', () => enforce(p[0])));
                document.getElementById('b-add1').addEventListener('click', () => this.addP(1));
                document.getElementById('b-add10').addEventListener('click', () => this.addP(10));
                document.getElementById('b-rst').addEventListener('click', () => this.reset());

                let pt = new THREE.Vector2();
                this.container.addEventListener('pointerdown', e => pt.set(e.clientX, e.clientY));
                this.container.addEventListener('pointerup', e => {
                    if (Math.hypot(e.clientX - pt.x, e.clientY - pt.y) < 5) this.click(e);
                });
            }

            click(e) {
                if (this.isSunk) return;
                const r = this.container.getBoundingClientRect();
                const m = new THREE.Vector2(((e.clientX - r.left) / r.width) * 2 - 1, -((e.clientY - r.top) / r.height) * 2 + 1);

                const rc = new THREE.Raycaster();
                rc.setFromCamera(m, this.camera);

                const hit = rc.intersectObjects([...this.boatGroup.children, ...this.pennyMeshes]).find(i => i.object.geometry.type.includes('Box') || i.object.geometry.type.includes('Cylinder'));

                if (hit) {
                    let loc = this.boatGroup.worldToLocal(hit.point.clone());
                    let maxW = this.wid / 2 - 0.5, maxL = this.len / 2 - 0.5;
                    this.dropP(Math.max(-maxW, Math.min(maxW, loc.x)), this.hgt + 0.5, Math.max(-maxL, Math.min(maxL, loc.z)));
                }
            }

            updateFoilUI(warn = false) {
                let w = this.wid + 2 * this.hgt, l = this.len + 2 * this.hgt;
                document.getElementById('f-txt').innerText = `${w} x ${l} cm`;
                document.getElementById('f-bw').style.width = `${Math.min(100, (w / 15) * 100)}%`;
                document.getElementById('f-bl').style.width = `${Math.min(100, (l / 25) * 100)}%`;
                document.getElementById('f-bw').className = w >= 15 ? 'bg-amber-500 h-1.5 rounded-full transition-all' : 'bg-sky-400 h-1.5 rounded-full transition-all';
                document.getElementById('f-bl').className = l >= 25 ? 'bg-amber-500 h-1.5 rounded-full transition-all' : 'bg-indigo-400 h-1.5 rounded-full transition-all';
                document.getElementById('f-wrn').classList.toggle('hidden', !(warn || w >= 15 || l >= 25));
            }

            resize() {
                this.camera.aspect = this.container.clientWidth / this.container.clientHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(this.container.clientWidth, this.container.clientHeight);
            }

            reset() {
                this.pennies = this.floatingPennies = this.targetPitch = this.targetRoll = 0;
                this.isSunk = false;
                this.boatGroup.rotation.set(0, 0, 0);

                this.pennyMeshes.forEach(m => { this.scene.remove(m); m.geometry.dispose(); });
                this.pennyMeshes = [];

                this.pennyBodies.forEach(b => this.world.removeBody(b));
                this.pennyBodies = [];

                document.getElementById('s-ovr').classList.replace('opacity-100', 'opacity-0');
                document.getElementById('s-ovr').classList.replace('pointer-events-auto', 'pointer-events-none');
                document.getElementById('s-mod').classList.replace('scale-100', 'scale-95');

                this.buildBoat();
                this.updatePhys();
            }

            dropP(x, y, z) {
                if (this.isSunk) return;
                this.pennies++;

                const mesh = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 0.1, 16), this.pennyMat);
                mesh.castShadow = true;
                const wp = this.boatGroup.localToWorld(new THREE.Vector3(x, y, z));
                mesh.position.copy(wp);
                this.scene.add(mesh);
                this.pennyMeshes.push(mesh);

                const body = new CANNON.Body({ mass: this.PENNY_MASS, material: this.mat, position: new CANNON.Vec3(wp.x, wp.y, wp.z) });

                // cannon-es Cylinder is natively Y-aligned (matching Three.js)! Removing the offset fixes the resting orientation.
                body.addShape(new CANNON.Cylinder(0.5, 0.5, 0.1, 16));

                // Start the pennies laying completely flat, with a random horizontal rotation
                body.quaternion.setFromEuler(0, Math.random() * Math.PI * 2, 0);

                // Add damping so pennies settle into a neat stack quickly
                body.angularDamping = 0.5;
                body.linearDamping = 0.1;

                this.world.addBody(body);
                this.pennyBodies.push(body);

                this.updatePhys();
                if (!this.isSunk) this.floatingPennies = this.pennies;
            }

            addP(n) {
                for (let i = 0; i < n; i++) {
                    if (this.isSunk) break;
                    this.dropP((Math.random() - 0.5) * (this.wid - 1), this.hgt + 0.5 + i * 0.2, (Math.random() - 0.5) * (this.len - 1));
                }
            }

            updatePhys() {
                this.massBoat = ((this.wid * this.len) + 2 * this.wid * this.hgt + 2 * this.len * this.hgt) * this.FOIL_AREA_DENSITY;
                this.massTotal = this.massBoat + this.pennies * this.PENNY_MASS;

                let cx = 0, cz = 0;
                this.pennyMeshes.forEach(p => {
                    let loc = this.boatGroup.worldToLocal(p.position.clone());
                    cx += loc.x * this.PENNY_MASS; cz += loc.z * this.PENNY_MASS;
                });

                cx /= this.massTotal || 1; cz /= this.massTotal || 1;
                this.targetRoll = -(cx / (this.wid / 2)) * (Math.PI / 6);
                this.targetPitch = (cz / (this.len / 2)) * (Math.PI / 6);

                let vol = this.massTotal / this.WATER_DENSITY;
                this.draft = vol / (this.wid * this.len);

                if (!this.isSunk) {
                    if (this.draft > this.hgt) this.sink("Too heavy! Max displacement exceeded.");
                    else {
                        let cap = false;
                        [[this.wid / 2, this.len / 2], [-this.wid / 2, this.len / 2], [this.wid / 2, -this.len / 2], [-this.wid / 2, -this.len / 2]].forEach(([x, z]) => {
                            let v = new THREE.Vector3(x, this.hgt, z).applyEuler(new THREE.Euler(this.targetPitch, 0, this.targetRoll));
                            if (v.y - this.draft < 0) cap = true;
                        });
                        if (cap) this.sink("Capsized! Uneven weight caused it to take on water.");
                    }
                }

                document.getElementById('s-mass').innerText = `${this.massTotal.toFixed(1)} g`;
                document.getElementById('s-drft').innerText = `${this.draft.toFixed(2)} cm`;
                document.getElementById('s-vol').innerText = `${vol.toFixed(1)} cmÂ³`;
                document.getElementById('s-cnt').innerText = this.pennies;
            }

            sink(rsn) {
                this.isSunk = true;
                this.aBuoy.visible = this.aGrav.visible = false;
                document.getElementById('f-cnt').innerText = this.floatingPennies;
                document.getElementById('s-rsn').innerText = rsn;

                setTimeout(() => {
                    document.getElementById('s-ovr').classList.replace('opacity-0', 'opacity-100');
                    document.getElementById('s-ovr').classList.replace('pointer-events-none', 'pointer-events-auto');
                    document.getElementById('s-mod').classList.replace('scale-95', 'scale-100');
                }, 1000);
            }

            anim() {
                requestAnimationFrame(() => this.anim());
                this.controls.update();

                if (this.world) this.world.step(1 / 60);

                if (this.boatPhys) {
                    this.boatPhys.position.copy(this.boatGroup.position);
                    this.boatPhys.quaternion.copy(this.boatGroup.quaternion);
                }

                this.pennyMeshes.forEach((m, i) => {
                    m.position.copy(this.pennyBodies[i].position);
                    m.quaternion.copy(this.pennyBodies[i].quaternion);
                });

                let ty = this.isSunk ? -10 + this.hgt / 2 : -this.draft;
                this.waterGroup.visible = !this.isSunk;
                this.waterSolid.visible = this.isSunk;

                if (!this.isSunk) this.aBuoy.visible = this.aGrav.visible = true;

                this.boatGroup.position.y += (ty - this.boatGroup.position.y) * 0.05;
                this.boatGroup.rotation.x += (this.targetPitch - this.boatGroup.rotation.x) * 0.05;
                this.boatGroup.rotation.z += (this.targetRoll - this.boatGroup.rotation.z) * 0.05;

                if (!this.isSunk && this.pennies > 0) this.updatePhys();
                this.renderer.render(this.scene, this.camera);
            }
        }

        // Attach to window so the HTML onclick="window.lab.reset()" works!
        window.lab = new PennyBoatLab3D();
    </script>
</body>

</html>