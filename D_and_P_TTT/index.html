<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Epic Dino vs Penguin Battle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Press+Start+2P&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for in-browser JSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      body {
        background-color: #0f172a;
        color: #ffffff;
        font-family: 'Roboto', sans-serif;
        overflow-x: hidden;
        margin: 0;
      }
      .font-arcade { font-family: 'Press Start 2P', cursive; }
      .font-epic { font-family: 'Black Ops One', cursive; }
      
      @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0px); }
      }
      .animate-float { animation: float 3s ease-in-out infinite; }
      
      @keyframes fall {
        to { transform: translateY(110vh) rotate(720deg); }
      }
      
      .confetti-piece {
        position: absolute;
        width: 12px;
        height: 12px;
        border-radius: 4px;
        animation: fall 3s linear forwards;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useCallback, useMemo } = React;

      // --- Audio Service ---
      class AudioService {
        constructor() {
          this.ctx = null;
          this.isMuted = false;
          try {
            const AudioContextClass = window.AudioContext || window.webkitAudioContext;
            this.ctx = new AudioContextClass();
          } catch (e) {
            console.error("Web Audio API not supported");
          }
        }

        ensureContext() {
          if (this.ctx && this.ctx.state === 'suspended') {
            this.ctx.resume();
          }
        }

        toggleMute() {
          this.isMuted = !this.isMuted;
          return this.isMuted;
        }

        playTone(freq, type = 'sine', duration = 0.1) {
          if (this.isMuted || !this.ctx) return;
          this.ensureContext();
          const osc = this.ctx.createOscillator();
          const gain = this.ctx.createGain();
          osc.type = type;
          osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
          gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + duration);
          osc.connect(gain);
          gain.connect(this.ctx.destination);
          osc.start();
          osc.stop(this.ctx.currentTime + duration);
        }

        playMove() { this.playTone(600, 'square', 0.1); }
        playWin() {
          if (this.isMuted || !this.ctx) return;
          [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
            setTimeout(() => this.playTone(freq, 'sawtooth', 0.2), i * 100);
          });
        }
        playDraw() {
          if (this.isMuted || !this.ctx) return;
          this.playTone(200, 'triangle', 0.3);
          setTimeout(() => this.playTone(150, 'triangle', 0.4), 300);
        }
        playReset() { this.playTone(800, 'sine', 0.15); }
      }

      const audioService = new AudioService();

      // --- Constants ---
      const WINNING_COMBINATIONS = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8],
        [0, 3, 6], [1, 4, 7], [2, 5, 8],
        [0, 4, 8], [2, 4, 6]
      ];
      const DINO_ICON = "ü¶ñ";
      const PENGUIN_ICON = "üêß";
      const MINION_ICON = "üçå";

      // --- Components ---
      
      const Square = ({ value, onClick, isWinningSquare, disabled }) => {
        const baseClasses = "h-24 w-24 sm:h-32 sm:w-32 bg-opacity-20 backdrop-blur-lg border-2 rounded-xl text-5xl sm:text-6xl flex items-center justify-center transition-all duration-200 transform hover:scale-105 active:scale-95 shadow-lg";
        let colorClasses = "border-white/10 bg-white/5 hover:bg-white/10 cursor-pointer";
        let content = null;

        if (value === 'DINO') {
          colorClasses = "border-green-500 bg-green-900/30 shadow-[0_0_15px_rgba(34,197,94,0.5)]";
          content = <span className="animate-bounce drop-shadow-md">{DINO_ICON}</span>;
        } else if (value === 'PENGUIN') {
          colorClasses = "border-cyan-400 bg-cyan-900/30 shadow-[0_0_15px_rgba(34,211,238,0.5)]";
          content = <span className="animate-bounce drop-shadow-md">{PENGUIN_ICON}</span>;
        } else if (value === 'MINION') {
          colorClasses = "border-yellow-400 bg-yellow-900/30";
          content = <span className="animate-spin">{MINION_ICON}</span>;
        }

        if (isWinningSquare) {
          colorClasses += " ring-4 ring-yellow-400 scale-110 z-10 !bg-yellow-500/20";
        }

        if (disabled && !value) {
          colorClasses += " cursor-default hover:bg-white/5 hover:scale-100";
        }

        return (
          <button className={`${baseClasses} ${colorClasses}`} onClick={onClick} disabled={disabled}>
            {content}
          </button>
        );
      };

      const Confetti = () => {
        const [particles, setParticles] = useState([]);

        useEffect(() => {
          const colors = ['#ef4444', '#22c55e', '#3b82f6', '#eab308', '#a855f7'];
          const count = 50;
          const newParticles = [];
          for (let i = 0; i < count; i++) {
            newParticles.push({
              id: i,
              x: Math.random() * 100,
              y: -10 - Math.random() * 20,
              color: colors[Math.floor(Math.random() * colors.length)],
              rotation: Math.random() * 360,
              delay: Math.random() * 2,
            });
          }
          setParticles(newParticles);
        }, []);

        return (
          <div className="fixed inset-0 pointer-events-none overflow-hidden z-50">
            {particles.map((p) => (
              <div
                key={p.id}
                className="confetti-piece"
                style={{
                  left: `${p.x}%`,
                  top: `${p.y}%`,
                  backgroundColor: p.color,
                  transform: `rotate(${p.rotation}deg)`,
                  animationDelay: `${p.delay}s`,
                }}
              />
            ))}
          </div>
        );
      };

      const ScoreBoard = ({ scores, currentPlayer, winner }) => {
        return (
          <div className="flex w-full max-w-lg justify-between items-center mb-8 px-4">
            <div className={`flex flex-col items-center p-4 rounded-2xl border-2 transition-all duration-300 ${currentPlayer === 'DINO' && !winner ? 'border-green-500 bg-green-900/20 scale-110 shadow-[0_0_20px_rgba(34,197,94,0.4)]' : 'border-gray-700 bg-gray-800/50 opacity-70'}`}>
              <span className="text-4xl mb-2">{DINO_ICON}</span>
              <h2 className="text-lg font-bold text-green-400 font-arcade">DINO</h2>
              <span className="text-3xl font-epic text-white">{scores.DINO}</span>
            </div>

            <div className="mx-4 text-center">
              <div className="text-xs text-gray-400 mb-1 font-arcade tracking-widest">VS</div>
              {winner ? (
                 <div className="animate-bounce text-yellow-400 text-2xl font-bold font-epic">
                   {winner === 'DRAW' ? 'TIE!' : 'WIN!'}
                 </div>
              ) : (
                <div className="text-gray-500 font-mono text-sm">BATTLE</div>
              )}
            </div>

            <div className={`flex flex-col items-center p-4 rounded-2xl border-2 transition-all duration-300 ${currentPlayer === 'PENGUIN' && !winner ? 'border-cyan-400 bg-cyan-900/20 scale-110 shadow-[0_0_20px_rgba(34,211,238,0.4)]' : 'border-gray-700 bg-gray-800/50 opacity-70'}`}>
              <span className="text-4xl mb-2">{PENGUIN_ICON}</span>
              <h2 className="text-lg font-bold text-cyan-400 font-arcade">PENGUIN</h2>
              <span className="text-3xl font-epic text-white">{scores.PENGUIN}</span>
            </div>
          </div>
        );
      };

      const GameBoard = ({ gameState, setGameState, onGameEnd }) => {
        const [winningLine, setWinningLine] = useState(null);

        useEffect(() => {
          if (gameState.winner === null) {
            setWinningLine(null);
          }
        }, [gameState.winner]);

        const checkWinner = (squares) => {
          for (let i = 0; i < WINNING_COMBINATIONS.length; i++) {
            const [a, b, c] = WINNING_COMBINATIONS[i];
            if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {
              return { winner: squares[a], line: WINNING_COMBINATIONS[i] };
            }
          }
          return null;
        };

        const handleSquareClick = (index) => {
          if (gameState.board[index] || gameState.winner) return;

          audioService.playMove();
          const newBoard = [...gameState.board];
          const currentPlayer = gameState.isXNext ? 'DINO' : 'PENGUIN';
          newBoard[index] = currentPlayer;

          const winResult = checkWinner(newBoard);
          let newWinner = null;

          if (winResult) {
            newWinner = winResult.winner;
            setWinningLine(winResult.line);
            onGameEnd(newWinner);
          } else if (!newBoard.includes(null)) {
            newWinner = 'DRAW';
            onGameEnd(newWinner);
          }

          setGameState(prev => ({
            ...prev,
            board: newBoard,
            isXNext: !prev.isXNext,
            winner: newWinner
          }));
        };

        return (
          <div className="grid grid-cols-3 gap-3 sm:gap-4 p-4 bg-white/5 rounded-2xl border border-white/10 backdrop-blur-sm shadow-2xl relative">
            <div className="absolute -top-10 -right-8 text-4xl animate-bounce delay-700 pointer-events-none opacity-80">
              üëÅÔ∏è
            </div>
            {gameState.board.map((cell, index) => (
              <Square
                key={index}
                value={cell}
                onClick={() => handleSquareClick(index)}
                isWinningSquare={winningLine?.includes(index) ?? false}
                disabled={gameState.winner !== null}
              />
            ))}
          </div>
        );
      };

      // --- Main App ---
      const App = () => {
        const [gameState, setGameState] = useState({
          board: Array(9).fill(null),
          isXNext: true,
          winner: null,
          scores: { DINO: 0, PENGUIN: 0 }
        });

        const [isMusicMuted, setIsMusicMuted] = useState(false);
        const [showMinionCelebration, setShowMinionCelebration] = useState(false);

        const handleGameEnd = useCallback((winner) => {
          if (winner === 'DRAW') {
            audioService.playDraw();
          } else {
            audioService.playWin();
            setGameState(prev => ({
              ...prev,
              scores: {
                ...prev.scores,
                [winner]: prev.scores[winner] + 1
              }
            }));
          }
        }, []);

        const resetGame = () => {
          audioService.playReset();
          setGameState(prev => ({
            ...prev,
            board: Array(9).fill(null),
            winner: null,
          }));
        };

        const toggleMusic = () => {
          const muted = audioService.toggleMute();
          setIsMusicMuted(muted);
        };

        useEffect(() => {
          if (gameState.winner === 'DRAW') {
            setShowMinionCelebration(true);
            const timer = setTimeout(() => setShowMinionCelebration(false), 3000);
            return () => clearTimeout(timer);
          }
        }, [gameState.winner]);

        return (
          <div className="min-h-screen w-full flex flex-col items-center justify-center p-4 relative overflow-hidden bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-slate-900 via-purple-900 to-slate-900">
            <div className="absolute inset-0 overflow-hidden pointer-events-none">
               <div className="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full bg-green-600/20 blur-[100px] animate-pulse"></div>
               <div className="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] rounded-full bg-cyan-600/20 blur-[100px] animate-pulse delay-1000"></div>
            </div>

            {gameState.winner && gameState.winner !== 'DRAW' && <Confetti />}

            {showMinionCelebration && (
              <div className="fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
                 <div className="text-9xl animate-bounce drop-shadow-2xl filter rotate-12">
                   {MINION_ICON}
                 </div>
                 <div className="absolute text-4xl font-arcade text-yellow-400 top-1/4 animate-pulse">
                   BANANA TIME!
                 </div>
              </div>
            )}

            <div className="z-10 text-center mb-6 relative">
              <h1 className="text-4xl sm:text-6xl font-epic text-transparent bg-clip-text bg-gradient-to-r from-green-400 via-yellow-300 to-cyan-400 drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)] animate-float">
                EPIC TIC-TAC-TOE
              </h1>
              <p className="text-slate-400 mt-2 font-mono text-xs sm:text-sm tracking-widest uppercase">
                Powered by AI ‚Ä¢ Referee: Minion Dave
              </p>
            </div>

            <div className="z-10 w-full flex justify-center">
              <ScoreBoard 
                scores={gameState.scores} 
                currentPlayer={gameState.isXNext ? 'DINO' : 'PENGUIN'} 
                winner={gameState.winner}
              />
            </div>

            <div className="z-10">
              <GameBoard 
                gameState={gameState} 
                setGameState={setGameState} 
                onGameEnd={handleGameEnd} 
              />
            </div>

            <div className="z-10 mt-10 flex gap-4">
              <button 
                onClick={resetGame}
                className="bg-gradient-to-r from-pink-500 to-violet-600 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-pink-500/50 transition transform hover:-translate-y-1 active:translate-y-0 font-arcade border border-white/20"
              >
                {gameState.winner ? 'REMATCH' : 'RESET BOARD'}
              </button>
              
              <button 
                onClick={toggleMusic}
                className={`p-3 rounded-full border transition-all ${isMusicMuted ? 'bg-red-500/20 border-red-500 text-red-400' : 'bg-green-500/20 border-green-500 text-green-400'}`}
                title="Toggle Sound"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                  {isMusicMuted ? (
                    <React.Fragment>
                      <line x1="1" y1="1" x2="23" y2="23"></line>
                      <path d="M9 9v6a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"></path>
                    </React.Fragment>
                  ) : (
                     <path d="M9 18V5l12-2v13"></path> 
                  )}
                   { !isMusicMuted && <circle cx="6" cy="18" r="3"></circle> }
                   { !isMusicMuted && <circle cx="18" cy="16" r="3"></circle> }
                </svg>
              </button>
            </div>

            <footer className="absolute bottom-4 text-white/20 text-xs font-mono">
              v1.0.0 ‚Ä¢ DO NOT FEED THE DINOSAURS
            </footer>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>