<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Battle</title>
<style>
 body{margin:0;background:#000;color:#fff;font-family:Arial,sans-serif;text-align:center;}
 h1{margin:1rem 0;color:#FF6600;}
 #rules{max-width:600px;margin:0 auto 1rem;font-size:1rem;line-height:1.4;}
 #lobby input{margin:0.25rem;padding:0.4rem;}
 #gameCanvas{background:#111;border:2px solid #FF6600;display:none;margin:0 auto;}
 #leaderboard{margin-top:0.5rem;font-weight:bold;}
 .hidden{display:none;}
</style>
</head>
<body>
<h1>Snake Battle</h1>
<div id="rules">
  <p>Control your snake with the arrow keys and collect power-ups for points. Avoid hitting the walls or your own tail. Each round lasts 30 seconds.</p>
</div>
<div id="lobby">
  <input id="nameInput" placeholder="Your name">
  <input id="colorInput" type="color" value="#00ff00">
  <button id="startBtn">Start Game</button>
</div>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="leaderboard" class="hidden"></div>
<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
const lobby=document.getElementById('lobby');
const nameInput=document.getElementById('nameInput');
const colorInput=document.getElementById('colorInput');
const startBtn=document.getElementById('startBtn');
const leaderboard=document.getElementById('leaderboard');

let snake=[],dir='right',power=null,score=0,timeLeft=30,loop=null,timer=null;
let playerName='Player',color='#00ff00',round=1;
let highScore=Number(localStorage.getItem('sbHighScore'))||0;

startBtn.onclick=startGame;
nameInput.addEventListener('keydown',e=>{if(e.key==='Enter') startGame();});

function startGame(){
  playerName=nameInput.value.trim()||'Player';
  color=colorInput.value;
  lobby.classList.add('hidden');
  canvas.style.display='block';
  leaderboard.classList.remove('hidden');
  startBtn.textContent='Start Game';
  initRound();
}

function initRound(){
  snake=[{x:10,y:15}];
  dir='right';
  power=spawnPower();
  score=0;
  timeLeft=30;
  render();
  loop=setInterval(gameStep,100);
  timer=setInterval(()=>{timeLeft--;if(timeLeft<=0) endRound();render();},1000);
}

document.addEventListener('keydown',e=>{
  if(e.key==='ArrowUp' && dir!=='down') dir='up';
  else if(e.key==='ArrowDown' && dir!=='up') dir='down';
  else if(e.key==='ArrowLeft' && dir!=='right') dir='left';
  else if(e.key==='ArrowRight' && dir!=='left') dir='right';
});

function gameStep(){
  const head={...snake[0]};
  if(dir==='up') head.y--; else if(dir==='down') head.y++; else if(dir==='left') head.x--; else head.x++;
  if(head.x<0||head.y<0||head.x>=40||head.y>=30||collision(head)) {endRound(); return;}
  snake.unshift(head);
  if(head.x===power.x && head.y===power.y){score+=5; power=spawnPower();}
  else snake.pop();
  render();
}

function spawnPower(){
  return {x:Math.floor(Math.random()*40),y:Math.floor(Math.random()*30)};
}

function collision(pos){
  return snake.some(seg=>seg.x===pos.x && seg.y===pos.y);
}

function endRound(){
  clearInterval(loop); clearInterval(timer);
  if(score>highScore){highScore=score; localStorage.setItem('sbHighScore',highScore);}
  leaderboard.textContent=`${playerName} Score: ${score} | High Score: ${highScore}`;
  startBtn.textContent='Play Again';
  lobby.classList.remove('hidden');
  canvas.style.display='none';
}

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='white';
  ctx.fillText(`Round ${round} - Time ${timeLeft}s`,10,10);
  if(power){ctx.fillStyle='#FFA633';ctx.fillRect(power.x*20,power.y*20,18,18);}
  ctx.fillStyle=color;
  snake.forEach(s=>ctx.fillRect(s.x*20,s.y*20,18,18));
}
</script>
</body>
</html>
