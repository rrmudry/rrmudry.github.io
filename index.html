<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Mr. Mudryâ€™s Physics â€¢ Home</title>
  <link rel="icon" type="image/png" href="head.png"/>
  <link rel="apple-touch-icon" href="head.png"/>
  <link rel="stylesheet" href="assets/theme.css"/>
  <style>
    .today-card {
      /* background: rgba(255, 255, 255, 0.02); */     /* Removed to match Quick Actions */
      /* border: 1px solid rgba(0, 243, 255, 0.15); */ /* Removed to match Quick Actions */
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); 
      position: relative;
    }
    .today-tag {
      font-family: var(--font-tech);
      font-size: 0.7rem;
      background: rgba(0, 243, 255, 0.15); /* Darker, transparent cyan */
      border: 1px solid var(--accent-neon);
      color: var(--accent-neon); /* Neon text */
      padding: 2px 8px;
      border-radius: 4px;
      margin-bottom: 0.5rem;
      display: inline-block;
      text-transform: uppercase;
      font-weight: bold;
    }
    /* Fully clear the section container */
    #today-section {
      background: none !important;
      border: none !important;
      box-shadow: none !important;
      padding-top: 1rem; /* Tighter integration */
    }
  </style>
</head>
<body>
  <div data-include="header"></div>

<main role="main">
  <section class="hero">
    <div class="container">
      <h1>Let's GO Physics HEROES!</h1>
      <div class="energy-bar" aria-hidden="true"></div>
      <p class="subtitle">Semester 2 begins Jan 12. Get ready for Momentum, Impulse, and the physics of impact!</p>
      <div class="cta-row">
        <a class="btn primary" href="lessons.html">Today's Lesson</a>
        <a class="btn" href="unit4-dashboard.html">Unit Roadmap</a>
        <a class="btn" href="circuit-game.html">Play Circuit Game</a>
      </div>
    </div>
  </section>

  <section class="container section" id="today-section" aria-labelledby="today-title">
    <h2 id="today-title">Today in Class</h2>
    <div id="today-widget-container" class="grid" style="grid-template-columns: 1fr; gap: 2rem;">
      <!-- Dynamically filled -->
    </div>
  </section>

  <section class="container section angle-bottom" id="events-section" aria-labelledby="whats-happening">
    <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 2rem;">
      <div>
        <h2 id="whats-happening">Upcoming Events</h2>
        <ul class="announcements" id="upcoming-list">
          <!-- Dynamically filled -->
        </ul>
      </div>
      <div>
        <h2 id="recent-lessons-title">Recent Lessons</h2>
        <ul class="announcements" id="recent-list">
          <!-- Dynamically filled -->
        </ul>
      </div>
    </div>
  </section>

  <section class="container section" aria-labelledby="quick-action">
    <h2 id="quick-action">Quick Action</h2>
    <div class="grid">
      <article class="card">
        <h3>Lesson Archive</h3>
        <p>Missed a day? Catch up on Semester 2 materials here.</p>
        <a class="btn primary" href="lessons.html">Open Archive</a>
      </article>
      <article class="card">
        <h3>âš¡ Circuit Game</h3>
        <p>Test your knowledge in our electrifying quiz.</p>
        <a class="btn" href="circuit-game.html">Play Now</a>
      </article>
      <article class="card">
        <h3>ðŸš€ Speed Calculator</h3>
        <p>Drag and drop values to solve velocity, distance, and time puzzles.</p>
        <a class="btn" href="physics_speed_calculator/dist/index.html">Launch App</a>
      </article>
      <article class="card">
        <h3>Extra Resources</h3>
        <p>News, videos, and classroom-ready links.</p>
        <a class="btn" href="resources.html">Explore</a>
      </article>
    </div>
  </section>
</main>

  <div data-include="footer"></div>
  <script>
    // 1. Define the initialization function
    function renderLessons() {
      const todayContainer = document.getElementById('today-widget-container');
      const upcomingList = document.getElementById('upcoming-list');
      const recentList = document.getElementById('recent-list');

      if (!todayContainer || !upcomingList || !recentList) return;
      if (typeof lessonsData === 'undefined' || !lessonsData.length) {
        todayContainer.innerHTML = `<p>No lessons posted yet for Semester 2.</p>`;
        upcomingList.innerHTML = `<li>No upcoming events.</li>`;
        recentList.innerHTML = `<li>No recent lessons.</li>`;
        return;
      }

      // Use local date for "today" comparison
      const now = new Date();
      const y = now.getFullYear();
      const m = String(now.getMonth() + 1).padStart(2, '0');
      const d = String(now.getDate()).padStart(2, '0');
      const todayStr = `${y}-${m}-${d}`;
      
      // Find today's lesson or the most recent past lesson
      const sortedLessons = [...lessonsData].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      let todayLesson = sortedLessons.find(l => l.date <= todayStr);
      let upcomingLessons = sortedLessons.filter(l => l.date > todayStr).reverse();
      let pastLessons = sortedLessons.filter(l => l.date < (todayLesson ? todayLesson.date : todayStr));

      // 1. Render Today's Lesson
      if (todayLesson) {
        todayContainer.innerHTML = `
          <article class="card today-card animate-in fade-in duration-500">
            <span class="today-tag">${todayLesson.date === todayStr ? "Today's Lesson" : "Latest Lesson"}</span>
            <span style="display:block; font-size: 0.8rem; opacity: 0.7; margin-bottom: 0.25rem;">Day ${todayLesson.day} â€¢ ${todayLesson.date}</span>
            <h3>${todayLesson.title}</h3>
            <p>${todayLesson.summary}</p>
            <div style="display: flex; gap: 0.75rem; margin-top: 1rem; flex-wrap: wrap;">
              <a class="btn primary" href="lessons.html">Full Details</a>
              <a class="btn" href="unit4-dashboard.html">Unit Dashboard</a>
            </div>
          </article>
        `;
      }

      // 2. Render Upcoming Events
      if (upcomingLessons.length > 0) {
        upcomingList.innerHTML = upcomingLessons.map(l => `
          <li class="animate-in slide-in-from-left-2 duration-300"><time datetime="${l.date}">${l.date.split('-').slice(1).join('/')}</time> ${l.title}</li>
        `).join('');
      } else {
        upcomingList.innerHTML = `<li>No upcoming events scheduled.</li>`;
      }

      // 3. Render Recent Lessons
      if (pastLessons.length > 0) {
        recentList.innerHTML = pastLessons.slice(0, 3).map(l => `
          <li class="animate-in slide-in-from-left-2 duration-300"><time datetime="${l.date}">${l.date.split('-').slice(1).join('/')}</time> <a href="lessons.html" style="color: inherit; text-decoration: none; border-bottom: 1px dashed var(--accent-neon);">${l.title}</a></li>
        `).join('');
      } else {
        recentList.innerHTML = `<li>No recent lessons found.</li>`;
      }
    }

    // 2. Load the script with a cache-buster
    const lessonScript = document.createElement('script');
    lessonScript.src = 'assets/lessons-data.js?v=' + Date.now();
    // Run render when script is loaded OR when DOM is ready, whichever is later
    lessonScript.onload = () => {
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        renderLessons();
      }
    };
    document.head.appendChild(lessonScript);

    // Also try on DOMContentLoaded in case script loads instantly (cache)
    document.addEventListener('DOMContentLoaded', () => {
      renderLessons();
    });
  </script>
  <script src="assets/partials.js"></script>
</body>
</html>
